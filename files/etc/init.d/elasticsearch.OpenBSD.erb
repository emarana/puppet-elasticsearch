#!/bin/sh
#
# This file is managed via PUPPET

daemon="/usr/local/elasticsearch-legacy/bin/elasticsearch-legacy"
daemon_flags="-d -<%= opt_flag %>default.path.conf=/etc/elasticsearch-legacy/<%= @resource[:instance] %> -p <%= @resource[:pid_dir] %>/elasticsearch-legacy-<%= @resource[:instance] %>.pid"
daemon_user="_elasticsearch-legacy"

. /etc/rc.d/rc.subr

pexp="$(/usr/local/bin/javaPathHelper -c elasticsearch-legacy) .*org.elasticsearch-legacy.bootstrap.elasticsearch-legacy.*"

rc_reload=NO

rc_start() {
	${rcexec} \
		"ES_INCLUDE=\"/etc/elasticsearch-legacy/elasticsearch-legacy.in.sh\" \
		"ES_JVM_OPTIONS=\"/etc/elasticsearch-legacy/<%= @resource[:instance] %>/jvm.options\"" \
		JAVA_HOME=\"$(/usr/local/bin/javaPathHelper -h elasticsearch-legacy)\" \
		${daemon} ${daemon_flags}"
}

rc_pre() {
	install -d -o _elasticsearch-legacy <%= @resource[:pid_dir] %>
}

rc_cmd $1
